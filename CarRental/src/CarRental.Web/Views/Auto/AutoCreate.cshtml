@model CarRental.DataAccess.Entities.Auto
<div id="autoid" class="row">
    <h2 class="text-center">Naujas automobilis</h2>
    <div class="form-horizontal col-md-6">
        <h3 class="text-center">Pagrindiniai duomenys</h3>      
        <div class="form-group">
            <label class="col-md-3 control-label">Markė</label>
            <div class="col-md-9">
                <input asp-for="Make" id="make" class="form-control" />
                <span asp-validation-for="Make" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Modelis</label>
            <div class="col-md-9">
                <input asp-for="Model" id="model" class="form-control" />
                <span asp-validation-for="Model" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Metai</label>
            <div class="col-md-9">
                <input asp-for="Year" id="year" class="form-control" />
                <span asp-validation-for="Year" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Valstybinis nr.</label>
            <div class="col-md-9">
                <input asp-for="PlateNumber" id="plateNumber" class="form-control" />
                <span asp-validation-for="PlateNumber" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Spalva</label>
            <div class="col-md-9">
                <input asp-for="Color" id="color" class="form-control" />
                <span asp-validation-for="Color" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Dokumento nr.</label>
            <div class="col-md-9">
                <input asp-for="DocumentNumber" id="documentNumber" class="form-control" />
                <span asp-validation-for="DocumentNumber" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Variklio tūris</label>
            <div class="col-md-9">
                <input asp-for="EngineCapicity" id="engineCapicity" class="form-control" />
                <span asp-validation-for="EngineCapicity" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Kilometražas</label>
            <div class="col-md-9">
                <input asp-for="Milleage" id="milleage" class="form-control" />
                <span asp-validation-for="Milleage" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Keistas diržas</label>
            <div class="col-md-9">
                <input asp-for="MainBelt" id="mainBelt" class="form-control" />
                <span asp-validation-for="MainBelt" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Keisti tepalai</label>
            <div class="col-md-9">
                <input asp-for="OilChange" id="oilChange" class="form-control" />
                <span asp-validation-for="OilChange" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">TA pabaiga</label>
            <div class="col-md-9">
                <div class='input-group date' id='datepickerTaEnd'>
                    <input type='text' class="form-control" id="tAEnd" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Draudimo pabaiga</label>
            <div class="col-md-9">
                <div class='input-group date' id='datepickerInsuranceEnd'>
                    <input type='text' class="form-control" id="insurenceEnd" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Kasko pabaiga</label>
            <div class="col-md-9">
                <div class='input-group date' id='datepickerCascoInsurenceEnd'>
                    <input type='text' class="form-control" id="cascoInsurenceEnd" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Audio kodas</label>
            <div class="col-md-9">
                <input asp-for="AudioCode" id="audioCode" class="form-control" />
                <span asp-validation-for="AudioCode" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Komentarai</label>
            <div class="col-md-9">
                <input asp-for="Comments" id="comments" class="form-control" />
                <span asp-validation-for="Comments" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Kuro tipas</label>
            <div class="col-md-9">
                <input asp-for="FuelType" id="fuelType" class="form-control" />
                <span asp-validation-for="FuelType" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Pavarų dėžė</label>
            <div class="col-md-9">
                <input asp-for="Gearbox" id="gearbox" class="form-control" />
                <span asp-validation-for="Gearbox" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Aktyvus</label>
            <div class="col-md-9">
                <input asp-for="Activity" id="activity" class="form-control" />
                <span asp-validation-for="Activity" class="text-danger"></span>
            </div>
        </div>
    </div>
    <div class="form-horizontal col-md-6">
        <h3 class="text-center">Paros nuomos kaina</h3>
        <div class="form-group">
            <label class="col-md-3 control-label">Iki 2 parų</label>
            <div class="col-md-9">
                <input type="number" name="price[]" id="2days" class="form-control" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Iki 6 parų</label>
            <div class="col-md-9">
                <input type="number" name="price[]" id="6days" class="form-control" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Iki 13 parų</label>
            <div class="col-md-9">
                <input type="number" name="price[]" id="13days" class="form-control" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Iki 22 parų</label>
            <div class="col-md-9">
                <input type="number" name="price[]" id="22days" class="form-control" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">Iki 30 parų</label>
            <div class="col-md-9">
                <input type="number" name="price[]" id="30days" class="form-control" />
            </div>
        </div>
        <h4 class="text-center">Pridėti nuotrauką</h4>
        <div class="form-group">
            <label class="col-md-3 control-label">Įkelti</label>
            <div class="col-md-9">
                <input type="file" id="fileUploads" />
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="button" value="Įvesti" class="btn btn-default" id="butt" />
        </div>
    </div>
    <p class="col-md-12">
        <a asp-action="AutoIndex">Grįžti į sąrašą</a>
    </p>
</div>

<script>
    $("#datepickerTaEnd").datepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        language: "lt",
        orientation: "top"
    });

    $("#datepickerInsuranceEnd").datepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        language: "lt",
        orientation: "top"
    });

    $("#datepickerCascoInsurenceEnd").datepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        language: "lt",
        orientation: "top"
    });

    var fileName = "";
    function uploadFile() {
        var d = new FormData();
        var f = document.getElementById('fileUploads').files[0];
        d.append('file', f);

        $.ajax({
            type: "POST",
            url: "../api/autos",
            data: d,
            contentType: false,
            processData: false,
            dataType: 'json',
            success: function (id) {
                fileName = id.id;
                create();
            },
            error: function (x) {
                fileName = "";
                create();
            }
        });
    }

    function create() {


        $.ajax({
            type: "POST",
            url: "../api/autos/" + document.getElementById('2days').value + '/'
            + document.getElementById('6days').value + '/'
            + document.getElementById('13days').value + '/'
            + document.getElementById('22days').value + '/'
            + document.getElementById('30days').value,
            data: JSON.stringify({
                "Model": document.getElementById('model').value,
                "Make": document.getElementById('make').value,
                "PriceId": 5,
                "Year": check(document.getElementById('year').value),
                "PlateNumber": document.getElementById('plateNumber').value,
                "Color": document.getElementById('color').value,
                "DocumentNumber": document.getElementById('documentNumber').value,
                "EngineCapicity": check(document.getElementById('engineCapicity').value),
                "Milleage": check(document.getElementById('milleage').value),
                "MainBelt": check(document.getElementById('mainBelt').value),
                "OilChange": check(document.getElementById('oilChange').value),
                "TAEnd": checkDate(document.getElementById('tAEnd').value),
                "InsurenceEnd": checkDate(document.getElementById('insurenceEnd').value),
                "CascoInsurenceEnd": checkDate(document.getElementById('cascoInsurenceEnd').value),
                "AudioCode": document.getElementById('audioCode').value,
                "Comments": document.getElementById('comments').value,
                "FuelType": document.getElementById('fuelType').value,
                "Gearbox": document.getElementById('gearbox').value,
                "Activity": document.getElementById('activity').value,
                "Photo": fileName
            }),
            contentType: "application/json",
            success: function (id) {
                location.href = "/Auto/AutoIndex";
            }
        });
    }


    function check(id) {
        if (id.length == 0) {
            id = 0;
            return id;
        }
        return id;
    }

    function checkDate(date) {
        if (date.length == 0) {
            date = '2000-01-01'
            return date;

        }
        return date;
    }

    $(function () {
        $('#butt').on('click', function () {
            uploadFile();
        });
    });
</script>
